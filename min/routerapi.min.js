!function(){var a=function(a){void 0===window.___modulesCountRouterAPI&&(window.___modulesCountRouterAPI=0),this._manifest="./manifest.php",a&&(this._manifest=a),this.DATA_TYPE_JSON="JSON",this.DATA_TYPE_XML="XML",this.DATA_TYPE_URLENCODED="urlencoded",this.DATA_TYPE_URLEMBEDDED="urlembedded",this._actionStack=[],this._dict="",this._dictionaryReady=!1,this.count=0,this._currentDictNode="";var b=new XMLHttpRequest;b._this=this,b.addEventListener("load",function(){var a=this._this;a._dict=JSON.parse(this.responseText),a._dictionaryReady=!0,a._actionStack.length>0&&a.executeActionStack()}),b.open("GET",this._manifest),b.send()};a.prototype.addToActionStack=function(a){this.count++,this.count>100||this._actionStack.push(a)},a.prototype.executeActionStack=function(){for(var a=0;a<this._actionStack.length;a++){var b=this._actionStack[a];this.performAction(b[0],b[1],b[2])}this._actionStack=[]},a.prototype.performAction=function(a,b,c){if(!this._dictionaryReady)return void this.addToActionStack([a,b,c]);var d=this.checkDict(a);if(d!==!1){this._currentDictNode=d;var e=this.checkData(b);this._currentDictNode.hasOwnProperty("mod")?this.loadMod(this._currentDictNode,e,c):this.callEndpoint(this._currentDictNode,e,c)}},a.prototype.callEndpoint=function(a,b,c){var d=new XMLHttpRequest;d.onload=function(){this.getResponse(d.responseText,c)}.bind(this);var e="POST";"urlembedded"===a.requestformat&&(a.endpoint=this.TO_urlembedded(JSON.parse(b))),d.open(e,a.endpoint),"urlencoded"===a.requestformat&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(b)},a.prototype.loadMod=function(a,b,c){function f(){window.___modulesCountRouterAPI++,this["mod"+window.___modulesCountRouterAPI]=new window[d],a.data=b,a.callBack=c,this["mod"+window.___modulesCountRouterAPI].initialize(a)}var d=a.namespace;if(document.querySelector("[src='"+a.mod+"']"))f.call(this);else{var e=document.createElement("script");e.src=a.mod,document.head.appendChild(e),e.onload=f.bind(this)}},a.prototype.checkDict=function(a){for(var b=0,c=this._dict.length;b<c;b++)if(this._dict[b].action===a)return this._dict[b];return!1},a.prototype.checkData=function(a){var b=this._currentDictNode.requestformat,c=this["is"+b](a);if(c)return JSON.stringify(a);var d=this["TO_"+b](a);return d},a.prototype.getResponse=function(a,b){var c=a,d=this.checkAllTypes(a);if(this._currentDictNode.responseformat!==this.DATA_TYPE_JSON){if(!this["is"+this._currentDictNode.responseformat](a))return void console.error(this._currentDictNode.action,"Expected "+this._currentDictNode.responseformat+" data, but detected as",d,"Consider updating manifest.json entry for action:",this._currentDictNode.action,"setting responseformat:"+d);c=this["FROM_"+this._currentDictNode.responseformat](a),b(c)}else if(this.isJSON(a))console.log(JSON.parse(c)),b(JSON.parse(c));else if(console.error(this._currentDictNode.action,"Expected JSON data, received non-JSON: attempt to autodetect data returned ",d),void 0!==d)try{c=this["FROM_"+d](a),b(c)}catch(a){console.log(this._currentDictNode.action,"attempted convertion from ",d,"failed!")}},a.prototype.isJSON=function(a){try{JSON.parse(JSON.stringify(a))}catch(a){return!1}return!0},a.prototype.isurlencoded=function(a){var b=/[^=]*=[^=]*&?/g;return b.test(a)},a.prototype.isXML=function(a){var c,b=new DOMParser,d=b.parseFromString(a,"text/xml");return c=0===d.getElementsByTagName("parsererror").length},a.prototype.isurlembedded=function(a){return!0},a.prototype.checkAllTypes=function(a){return this.isJSON(a)?this.DATA_TYPE_JSON:this.isXML(a)?this.DATA_TYPE_XML:this.isurlencoded(a)?this.DATA_TYPE_URLENCODED:void 0},FROM_XML=function(a){if("string"==typeof a){var b=new DOMParser;a=b.parseFromString(a,"text/xml")}var c={};if(1==a.nodeType){if(a.attributes.length>0){c["@attributes"]={};for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c["@attributes"][e.nodeName]=e.nodeValue}}}else 3==a.nodeType&&(c=a.nodeValue);if(a.hasChildNodes())for(var f=0;f<a.childNodes.length;f++){var g=a.childNodes.item(f),h=g.nodeName;if("undefined"==typeof c[h])3==g.nodeType?c=g.nodeValue:c[h]=FROM_XML(g);else{if("undefined"==typeof c[h].push){var i=c[h];c[h]=[],c[h].push(i)}c[h].push(FROM_XML(g))}}return c},a.prototype.FROM_XML=FROM_XML,FROM_urlencoded=function(a){"use strict";a=a.trim(),"&"===a.slice(-1)&&(a=a.slice(0,-1));var b,c,d,e,f,g;for("function"!=typeof FROM_urlencoded.br&&(FROM_urlencoded.br=function(a){return a.indexOf("]")!==-1?a.replace(/\](.+?)(,|$)/g,function(a,b,c){return FROM_urlencoded.br(b+"}"+c)}):a}),a='{"'+(a.indexOf("%")!==-1?decodeURI(a):a)+'"}',b=a.replace(/\=/g,'":"').replace(/&/g,'","').replace(/\[/g,'":{"'),b=b.replace(/\](.+?)(,|$)/g,function(a,b,c){return FROM_urlencoded.br(b+"}"+c)}),b=JSON.parse(b),d=("&"+a).replace(/(\[|\]|\=)/g,'"$1"').replace(/\]"+/g,"]").replace(/&([^\[\=]+?)(\[|\=)/g,'"&["$1]$2'),d=(d+'"').replace(/^"&/,"").split("&"),c=0;c<d.length;c++)for(g=b,e=d[c].match(/(?!:(\["))([^"]+?)(?=("\]))/g),f=0;f<e.length;f++){if(!g.hasOwnProperty(e[f])){if(!(e.length>f+1)){g[e[f]]=d[c].split("=")[1].replace(/"/g,"");break}g[e[f]]={}}g=g[e[f]]}return b},a.prototype.FROM_urlencoded=FROM_urlencoded,a.prototype.TO_urlencoded=function(a){a instanceof Array&&(a=a[0]);var b="";for(key in a)b+=encodeURIComponent(key)+"="+encodeURIComponent(a[key])+"&";return b},a.prototype.TO_urlembedded=function(a){a instanceof Array&&(a=a[0]);var b=this._currentDictNode.endpoint;for(key in a)a.hasOwnProperty(key)&&(b=b.replace("{{"+key+"}}",a[key]));return b},a.prototype.TO_XML=function(a,b){var c=function(a,b,d){var e="";if(a instanceof Array)for(var f=0,g=a.length;f<g;f++)e+=d+c(a[f],b,d+"\t")+"\n";else if("object"==typeof a){var h=!1;e+=d+"<"+b;for(var i in a)"@"==i.charAt(0)?e+=" "+i.substr(1)+'="'+a[i].toString()+'"':h=!0;if(e+=h?">":"/>",h){for(var i in a)"#text"==i?e+=a[i]:"#cdata"==i?e+="<![CDATA["+a[i]+"]]>":"@"!=i.charAt(0)&&(e+=c(a[i],i,d+"\t"));e+=("\n"==e.charAt(e.length-1)?d:"")+"</"+b+">"}}else e+=d+"<"+b+">"+a.toString()+"</"+b+">";return e},d="";for(var e in a)d+=c(a[e],e,"");return b?d.replace(/\t/g,b):d.replace(/\t|\n/g,"")},window.RouterAPI=a}();
